{"version":3,"sources":["servePackage.js"],"names":[],"mappings":";;AAAA,IAAI,CAAC,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;;AAEhC,MAAM,CAAC,OAAO,GAAG,WAAW,IAAI,EAAE;gBACS,IAAI,CAAC,MAAM;MAA9C,QAAQ,WAAR,QAAQ;MAAW,WAAW;;AACpC,MAAI,eAAe,GAAG,GAAG,GAAG,QAAQ,GAAG,GAAG,IAAI,WAAW,IAAI,EAAE,CAAA,AAAC,CAAC;;AAEjE,MAAI,MAAM,GAAG,MAAM,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAC3D,MAAM,CAAC,EAAC,QAAQ,EAAE,eAAe,EAAC,CAAC,CACnC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAChC,KAAK,CAAC,CAAC,CAAC,CAAC;;AAEZ,MAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AACrB,QAAI,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;AACxB,QAAI,CAAC,OAAO,CAAC,WAAW,EAAE;;;;AAIxB,UAAI,CAAC,GAAG,CAAC;AACP,cAAM,EAAE,OAAO,CAAC,IAAI;AACpB,uBAAe,EAAE,OAAO,CAAC,aAAa,EACvC,CAAC,CAAC;;AAEH,UAAI,CAAC,IAAI,GAAG,wBAAwB,CAAC;AACrC,UAAI,CAAC,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC;AAC7B,aAAO;KACR;GACF;;AAED,MAAI,CAAC,IAAI,GAAG,YAAY,CAAC;AACzB,MAAI,SAAM,CAAC,GAAG,EAAE,qBAAqB,GAAG,eAAe,CAAC,CAAC;CAC1D,CAAC","file":"servePackage.js","sourcesContent":["var r = require('./database/r');\n\nmodule.exports = function *(next) {\n  let { username, package: packageName } = this.params;\n  var packageFullName = '@' + username + '/' + (packageName || '');\n\n  var result = yield r.db('exp_host').table('publishedPackages')\n    .filter({fullName: packageFullName})\n    .orderBy(r.desc('publishedTime'))\n    .limit(1);\n\n  if (result.length > 0) {\n    var article = result[0];\n    if (!article.unpublished) {\n      // TODO: Put metadata in the response headers\n\n      // Set headers\n      this.set({\n        'ETag': article.hash,\n        'Last-Modified': article.publishedTime,\n      });\n\n      this.type = 'application/javascript';\n      this.body = article.contents;\n      return;\n    }\n  }\n\n  this.type = 'text/plain';\n  this.throw(404, 'Article not found: ' + packageFullName);\n};\n"],"sourceRoot":"/source/"}