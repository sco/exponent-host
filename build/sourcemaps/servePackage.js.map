{"version":3,"sources":["servePackage.js"],"names":[],"mappings":";;AAAA,IAAI,CAAC,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;;AAEhC,MAAM,CAAC,OAAO,GAAG,WAAW,IAAI,EAAE;;AAEhC,MAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;AAC1B,MAAI,eAAe,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,GAAG,IAAI,GAAG,IAAI,EAAE,CAAA,AAAC,CAAC;;AAErE,MAAI,MAAM,GAAG,MAAM,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC,MAAM,CAAC,EAAC,QAAQ,EAAE,eAAe,EAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAC7I,MAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;;AAErB,QAAI,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;;AAExB,QAAI,CAAC,OAAO,CAAC,WAAW,EAAE;;;;AAIxB,UAAI,CAAC,GAAG,CAAC;AACP,cAAM,EAAE,OAAO,CAAC,IAAI;AACpB,uBAAe,EAAE,OAAO,CAAC,aAAa,EACvC,CAAC,CAAC;;AAEH,UAAI,CAAC,IAAI,GAAG,wBAAwB,CAAC;AACrC,UAAI,CAAC,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC;AAC7B,aAAO;KACR;GACF;;AAED,MAAI,CAAC,IAAI,GAAG,YAAY,CAAC;AACzB,MAAI,SAAM,CAAC,GAAG,EAAE,qBAAqB,GAAG,eAAe,CAAC,CAAC;CAE1D,CAAC","file":"servePackage.js","sourcesContent":["var r = require('./database/r');\n\nmodule.exports = function *(next) {\n\n  var pkg = this.params.pkg;\n  var packageFullName = '@' + this.params.username + '/' + (pkg || '');\n\n  var result = yield r.db('exp_host').table('publishedPackages').filter({fullName: packageFullName}).orderBy(r.desc('publishedTime')).limit(1);\n  if (result.length > 0) {\n\n    var article = result[0];\n\n    if (!article.unpublished) {\n      // TODO: Put metadata in the response headers\n\n      // Set headers\n      this.set({\n        'Etag': article.hash,\n        'Last-Modified': article.publishedTime,\n      });\n\n      this.type = 'application/javascript';\n      this.body = article.contents;\n      return;\n    }\n  }\n\n  this.type = 'text/plain';\n  this.throw(404, \"Article not found: \" + packageFullName);\n\n};\n"],"sourceRoot":"/source/"}