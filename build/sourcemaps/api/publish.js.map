{"version":3,"sources":["api/publish.js"],"names":[],"mappings":";;;;AAAA,IAAI,YAAY,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AAC3C,IAAI,MAAM,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC;AACzC,IAAI,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;;AAEjC,IAAI,QAAQ,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AACrC,IAAI,MAAM,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AAClC,IAAI,CAAC,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;;AAEjC,MAAM,CAAC,OAAO,GAAG;AACf,KAAG,EAAE,mCAAmC;AACxC,aAAW,oBAAE,WAAgB,GAAG,EAAE,IAAI,EAAE;;;AAGtC,QAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;;QAGjB,QAAQ,GAQN,IAAI,CARN,QAAQ;QACR,cAAc,GAOZ,IAAI,CAPN,cAAc;QACd,gBAAgB,GAMd,IAAI,CANN,gBAAgB;QAChB,cAAc,GAKZ,IAAI,CALN,cAAc;QACd,cAAc,GAIZ,IAAI,CAJN,cAAc;QACd,iBAAiB,GAGf,IAAI,CAHN,iBAAiB;QACjB,qBAAqB,GAEnB,IAAI,CAFN,qBAAqB;QACrB,QAAQ,GACN,IAAI,CADN,QAAQ;;AAGV,QAAI,eAAe,GAAG,GAAG,GAAG,cAAc,GAAG,GAAG,GAAG,iBAAiB,CAAC;;AAErE,WAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,eAAe,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,CAAC,CAAC;AAC9D,QAAI,QAAQ,GAAG,MAAM,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;;AAEnD,QAAI,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;AACzB,QAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;;;AAGxB,QAAI,MAAM,GAAG,MAAM,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC,MAAM,CAAC;AACpE,wBAAkB,EAAE,QAAQ;AAC5B,qBAAe,EAAE,cAAc;AAC/B,iBAAW,EAAE,iBAAiB;AAC9B,cAAQ,EAAE,eAAe;AACzB,mBAAa,EAAE,CAAC,CAAC,GAAG,EAAE;AACtB,aAAO,EAAE,cAAc;AACvB,cAAQ,EAAE,IAAI;AACd,UAAI,EAAE,IAAI,EACX,CAAC,CAAC;;AAEH,WAAO,EAAC,GAAG,EAAE,IAAI,EAAE,eAAe,EAAf,eAAe,EAAE,IAAI,EAAJ,IAAI,EAAE,CAAC;GAC5C,CAAA,EACF,CAAC","file":"api/publish.js","sourcesContent":["var instapromise = require('instapromise');\nvar md5hex = require('@exponent/md5hex');\nvar request = require('request');\n\nvar ApiError = require('./ApiError');\nvar config = require('../config');\nvar r = require('../database/r');\n\nmodule.exports = {\n  doc: \"Publishes a a package to exp.host\",\n  methodAsync: async function (env, args) {\n    // TODO: Validate args\n\n    var opts = args[0];\n\n    var {\n      username,\n      hashedPassword,\n      localPackageName,\n      packageVersion,\n      remoteUsername,\n      remotePackageName,\n      remoteFullPackageName,\n      ngrokUrl,\n    } = opts;\n\n    var packageFullName = '@' + remoteUsername + '/' + remotePackageName;\n\n    console.log(\"Saving\", packageFullName, \"from\", ngrokUrl, \".\");\n    var response = await request.promise.get(ngrokUrl);\n\n    var body = response.body;\n    var hash = md5hex(body);\n\n    // TODO: Verify that you can actually publish this\n    var result = await r.db(\"exp_host\").table(\"publishedPackages\").insert({\n      publishingUsername: username, // TODO: Change to be the username from the API\n      packageUsername: remoteUsername,\n      packageName: remotePackageName,\n      fullName: packageFullName,\n      publishedTime: r.now(),\n      version: packageVersion,\n      contents: body,\n      hash: hash,\n    });\n\n    return {err: null, packageFullName, hash,};\n  },\n};\n"],"sourceRoot":"/source/"}