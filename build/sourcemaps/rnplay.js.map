{"version":3,"sources":["rnplay.js"],"names":[],"mappings":"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","file":"rnplay.js","sourcesContent":["var _ = require('lodash-node');\nvar cheerio = require('cheerio');\nvar instapromise = require('instapromise');\nvar request = require('request');\nvar url = require('url');\nvar querystring = require('querystring');\n\nfunction RNPlayError(message) {\n  var err = new Error('RNPlayError: ' + message);\n  err._isRNPlayError = true;\n  return err;\n}\n\nasync function dataAsync(playUrl) {\n  try {\n    var response = await request.promise.get(playUrl);\n  } catch (e) {\n    throw RNPlayError(e.message);\n  }\n\n  var body = response.body;\n  var $ = cheerio.load(body);\n  var data = $('div[data-react-class=EditorApp]').data('reactProps');\n  if (data) {\n    return data;\n  } else {\n    throw RNPlayError(\"Failed to load data for Play\");\n  }\n};\n\nfunction expUrlFromData(data) {\n  var appetizeUrl = data.play.appetizeUrl;\n  var u = url.parse(appetizeUrl);\n  var q = querystring.parse(u.query);\n  var p = JSON.parse(q.params);\n  var bundleUrl = p.bundleUrl;\n  var moduleName = p.moduleName;\n  var expUrl = bundleUrl.replace(/https?:\\/\\//, 'exp://') + '?app=' + encodeURIComponent(moduleName);\n  return expUrl;\n}\n\nfunction rnplayUrlFromShortCode(shortCode) {\n  return 'https://rnplay.org/plays/' + shortCode;\n}\n\nasync function expUrlFromShortCodeAsync(shortCode) {\n  var rnplayUrl = rnplayUrlFromShortCode(shortCode);\n  var data = await dataAsync(rnplayUrl);\n  var expUrl = expUrlFromData(data);\n  return expUrl;\n}\n\nasync function expUrlFromPlayUrlAsync(playUrl) {\n  var data = await dataAsync(playUrl);\n  var expUrl = expUrlFromData(data);\n  return expUrl;\n}\n\nvar route = function *(next) {\n  try {\n    var expUrl = yield expUrlFromShortCodeAsync(this.params.shortCode);\n  } catch (e) {\n    this.status = 302;\n    this.response.redirect('/rnplay/?err=' + encodeURIComponent(e.message));\n    yield next;\n    return;\n  }\n\n  console.log(\"Redirecting to\", expUrl);\n  this.body = `\n<html>\n  <head>\n    <title>Get Exponent to View This Play</title>\n  </head>\n  <body>\n    You don't seem to have Exponent on your device, so you can't view this Play right now. Get Exponent at <a href=\"http://exp.host/\">http://exp.host/</a> and come back here to view the Play!\n  </body>\n</html>\n`;\n\n  // Since the module name could change, we should use a 302 here\n  this.status = 302;\n\n  this.response.redirect(expUrl);\n\n};\n\nvar form = function *(next) {\n\n  var html = `\n<html>\n<head>\n  <title>View an RNPlay in Exponent</title>\n</head>\n<body>\n`;\n\n  var err = this.query.err;\n  if (err) {\n    html += '<div style=\"color: red; font-weight: bold;\">' + err + '</div>';\n  }\n\n  html += `\n    <form method=\"GET\" onsubmit=\"window.location='/rnplay/' + document.getElementById('rnplay').value; return false;\">\n      <input type=\"text\" value=\"\" id=\"rnplay\" name=\"shortCodeOrUrl\" />\n      <input type=\"submit\" value=\" Go \" />\n    </form>\n  </body>\n</html>\n  `;\n\n  this.body = html;\n\n\n};\n\n\nmodule.exports = {\n  dataAsync,\n  expUrlFromShortCodeAsync,\n  rnplayUrlFromShortCode,\n  expUrlFromData,\n  route,\n  form,\n};\n\nif (require.main === module) {\n  var urlOrShortCode = process.argv[2];\n  var playUrl;\n  if (urlOrShortCode.match(/\\//)) {\n    playUrl = urlOrShortCode;\n  } else {\n    playUrl = rnplayUrlFromShortCode(urlOrShortCode);\n  }\n  console.error(\"Play URL:\", playUrl);\n  expUrlFromPlayUrlAsync(playUrl).then((expUrl) => {\n    console.log(expUrl);\n  }, console.error);\n}\n"],"sourceRoot":"/source/"}