{"version":3,"sources":["browser.js"],"names":[],"mappings":";;;;;;;;;;qBAmByB,uBAAuB;;IAMjC,eAAe,qBAA9B,WAA+B,OAAO,EAAE;AACtC,MAAI,WAAW,CAAC,OAAO,CAAC,EAAE;AACxB,WAAO,WAAW,CAAC,OAAO,CAAC,CAAC;GAC7B;;AAED,MAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EAAE;AACzC,QAAI,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,oBAAoB,CAAC,OAAO,CAAC,CAAC,CAAC;AAC3E,QAAI,MAAM,GAAG,MAAM,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;AAC3D,eAAW,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;AAC9B,WAAO,WAAW,CAAC,OAAO,CAAC,CAAC;GAC7B;;AAED,MAAI,SAAS,GAAG,mBAAmB,CAAC,OAAO,CAAC,CAAC;AAC7C,MAAI,CAAC,SAAS,EAAE;AACd,UAAM,IAAI,KAAK,CAAC,CAAC,8BAA8B,GAAE,OAAO,EAAC,CAAC,CAAC,CAAC;GAC7D;;AAED,MAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,EAAE;AACjC,uBAAmB,CAAC,OAAO,CAAC,GAAG,IAAI,SAAS,EAAE,CAAC;GAChD;;AAED,MAAI,IAAI,GAAG,mBAAmB,CAAC,OAAO,CAAC,CAAC;AACxC,QAAM,IAAI,CAAC,YAAY,EAAE,CAAC;;AAE1B,MAAI;AACF,QAAI,WAAW,CAAC,OAAO,CAAC,EAAE;AACxB,aAAO,WAAW,CAAC,OAAO,CAAC,CAAC;KAC7B;;AAED,QAAI,QAAQ,GAAG,MAAM,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;AAChD,QAAI,QAAQ,CAAC,UAAU,KAAK,GAAG,EAAE;AAC/B,iBAAW,CAAC,OAAO,CAAC,GAAG,QAAQ,CAAC,IAAI,CAAC;KACtC;AACD,WAAO,WAAW,CAAC,OAAO,CAAC,CAAC;GAC7B,SAAS;AACR,QAAI,CAAC,OAAO,EAAE,CAAC;GAChB;CAEF;;AA/DD,OAAO,CAAC,cAAc,CAAC,CAAC;;AAExB,MAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACzB,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC7B,MAAM,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;;AAEnC,MAAM,SAAS,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;;AAExC,MAAM,mBAAmB,GAAG;AAC1B,GAAC,EAAE,sFAAsF,EAC1F,CAAC;;AAEF,MAAM,oBAAoB,GAAG;AAC3B,GAAC,EAAE,oBAAoB,EACxB,CAAC;;AAEF,IAAI,WAAW,GAAG,EAAE,CAAC;AACrB,IAAI,mBAAmB,GAAG,EAAE,CAAC;;AAEd,UAAU,uBAAuB,GAAG;AACjD,MAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,GAAG,CAAC;AACxC,MAAI,CAAC,IAAI,GAAG,MAAM,eAAe,CAAC,OAAO,CAAC,CAAC;AAC3C,MAAI,CAAC,IAAI,GAAG,wBAAwB,CAAC;CACtC","file":"browser.js","sourcesContent":["require('instapromise');\n\nconst fs = require('fs');\nconst path = require('path');\nconst request = require('request');\n\nconst AwaitLock = require('await-lock');\n\nconst BROWSER_BUNDLE_URLS = {\n  1: 'http://localhost:8081/exponent.includeRequire.runModule.bundle?dev=false&minify=true',\n};\n\nconst BROWSER_BUNDLE_FILES = {\n  1: 'exponent.bundle.js',\n};\n\nvar bundleCache = {};\nvar bundleDownloadLocks = {};\n\nexport default function* serveBrowserBundleAsync() {\n  let version = this.query.version || '1';\n  this.body = yield loadBundleAsync(version);\n  this.type = 'application/javascript';\n}\n\nasync function loadBundleAsync(version) {\n  if (bundleCache[version]) {\n    return bundleCache[version];\n  }\n\n  if (process.env.NODE_ENV === 'production') {\n    let bundleFile = path.join(__dirname, '..', BROWSER_BUNDLE_FILES[version]);\n    let bundle = await fs.promise.readFile(bundleFile, 'utf8');\n    bundleCache[version] = bundle;\n    return bundleCache[version];\n  }\n\n  let bundleUrl = BROWSER_BUNDLE_URLS[version];\n  if (!bundleUrl) {\n    throw new Error(`No app bundle URL for version ${version}`);\n  }\n\n  if (!bundleDownloadLocks[version]) {\n    bundleDownloadLocks[version] = new AwaitLock();\n  }\n\n  var lock = bundleDownloadLocks[version];\n  await lock.acquireAsync();\n\n  try {\n    if (bundleCache[version]) {\n      return bundleCache[version];\n    }\n\n    let response = await request.promise(bundleUrl);\n    if (response.statusCode === 200) {\n      bundleCache[version] = response.body;\n    }\n    return bundleCache[version];\n  } finally {\n    lock.release();\n  }\n\n}\n"],"sourceRoot":"/source/"}