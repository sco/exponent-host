{"version":3,"sources":["index.js"],"names":[],"mappings":";;AAAA,IAAI,aAAa,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AAC7C,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACvB,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;;AAE3B,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;AACzB,IAAI,IAAI,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAC/B,IAAI,IAAI,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAC/B,IAAI,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AACnC,IAAI,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;;AAEnC,IAAI,GAAG,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AAC/B,IAAI,MAAM,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACjC,IAAI,YAAY,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;;AAE7C,IAAI,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC;;AAEtC,IAAI,GAAG,GAAG,GAAG,EAAE,CAAC;AAChB,GAAG,CAAC,IAAI,GAAG,UAAU,CAAC;AACtB,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC;AACjB,GAAG,CAAC,YAAY,GAAG,IAAI,CAAC;;AAExB,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC;AAClB,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;;;;;;;;;AAShB,IAAI,UAAU,GAAG,MAAM,EAAE,CAAC;;AAE1B,UAAU,CAAC,GAAG,CAAC,cAAc,EAAE,WAAU,IAAI,EAAE;AAC7C,MAAI,CAAC,IAAI,GAAG,YAAY,CAAC;AACzB,MAAI,CAAC,IAAI,GAAG,MAAM,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;CACpE,CAAC,CAAC;;AAGH,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,WAAU,IAAI,EAAE;AAClC,MAAI,WAAW,GAAG,+DAA+D,CAAC;AAClF,MAAI,CAAC,IAAI,GAAG,WAAW,CAAC;AACxB,MAAI,CAAC,IAAI,GAAG,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;qEAgDsD,GAAE,kBAAkB,CAAC,WAAW,CAAC,EAAC;;;;;;EAMrG,CAAC,CAAC;CACH,CAAC,CAAC;;;AAGH,UAAU,CAAC,GAAG,CAAC,YAAY,EAAE,WAAU,IAAI,EAAE;AAC3C,MAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC;AACpD,MAAI,CAAC,IAAI,GAAG,MAAM,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;CACxD,CAAC,CAAC;;AAEH,UAAU,CAAC,GAAG,CAAC,YAAY,EAAE,WAAU,IAAI,EAAE;AAC3C,MAAI,CAAC,IAAI,GAAG,6CAA6C,CAAC;CAC3D,CAAC,CAAC;;AAEH,UAAU,CAAC,GAAG,CAAC,YAAY,EAAE,WAAU,IAAI,EAAE;AAC3C,MAAI,CAAC,IAAI,GAAG,2CAA2C,CAAC;CACzD,CAAC,CAAC;;AAEH,UAAU,CAAC,GAAG,CAAC,2BAA2B,EAAE,GAAG,CAAC,UAAU,CAAC,CAAC;;AAE5D,UAAU,CAAC,GAAG,CAAC,eAAe,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC;;AAEtD,UAAU,CAAC,GAAG,CAAC,WAAW,EAAE,WAAU,IAAI,EAAE;AAC1C,SAAO,CAAC,cAAc,CAAC,CAAC;AACxB,MAAI,MAAM,GAAG,MAAM,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,mBAAmB,CAAC,EAAE,MAAM,CAAC,CAAC;AAC1F,MAAI,CAAC,IAAI,GAAG,wBAAwB,CAAC;AACrC,MAAI,CAAC,IAAI,GAAG,MAAM,CAAC;CACpB,CAAC,CAAC;;AAEH,UAAU,CAAC,GAAG,CAAC,kBAAkB,EAAE,YAAY,CAAC,CAAC;AACjD,UAAU,CAAC,GAAG,CAAC,aAAa,EAAE,YAAY,CAAC,CAAC;AAC5C,UAAU,CAAC,GAAG,CAAC,cAAc,EAAE,YAAY,CAAC,CAAC;;AAE7C,UAAU,CAAC,GAAG,CAAC,iBAAiB,EAAE,WAAU,IAAI,EAAE;AAChD,MAAI,CAAC,MAAM,GAAG,GAAG,CAAC;AAClB,MAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;;;;;CAKzC,CAAC,CAAC;;AAEH,UAAU,CAAC,GAAG,CAAC,cAAc,EAAE,WAAU,IAAI,EAAE;AAC7C,MAAI,CAAC,IAAI,GAAG,WAAW,CAAC;AACxB,MAAI,CAAC,IAAI,GAAG,MAAM,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,eAAe,CAAC,EAAE,MAAM,CAAC,CAAC;CAC5F,CAAC,CAAC;;AAEH,UAAU,CAAC,GAAG,CAAC,cAAc,EAAE,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC;;AAE5D,UAAU,CAAC,IAAI,CAAC,qBAAqB,EAAE,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC;;AAEpE,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,EAAC,UAAU,EAAC,EAAC,SAAS,EAAE,SAAS,EAAC,EAAC,CAAC,CAAC,CAAC;AACnD,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC;AAC7B,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,cAAc,EAAE,CAAC,CAAC;;;AAGrC,UAAU,CAAC,GAAG,CAAC,WAAW,EAAE,WAAU,IAAI,EAAE;AAC1C,SAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AACxD,MAAI,QAAQ,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AACrC,MAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;AAClC,MAAI,OAAO,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;AACtB,QAAI,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAC5B,QAAI,GAAG,GAAG,MAAM,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;AAC/C,WAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,IAAI,EAAE,eAAe,EAAE,GAAG,CAAC,CAAC;AAC9D,QAAI,GAAG,EAAE;AACP,UAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;KAC7B,MAAM;AACL,UAAI,SAAM,CAAC,GAAG,EAAE,qBAAqB,GAAG,IAAI,CAAC,CAAC;KAC/C;AACD,QAAI,CAAC,IAAI,GAAG,WAAW,EACvB,IAAI,CAAC,IAAI,GAAG,qBAAqB,GAAG,IAAI,CAAC;GAC1C,MAAM;AACL,UAAM,IAAI,CAAC;GACZ;CACF,CAAC,CAAC;;AAGH,IAAI,OAAO,CAAC,IAAI,KAAK,MAAM,EAAE;AAC3B,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,MAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,YAAY;AACxC,QAAI,IAAI,GAAG,MAAM,CAAC,OAAO,EAAE,CAAC;AAC5B,QAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;AACrB,QAAI,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;AACxB,WAAO,CAAC,GAAG,CAAC,sBAAsB,GAAG,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,kBAAkB,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;GACrG,CAAC,CAAC;CACJ","file":"index.js","sourcesContent":["var child_process = require('child_process');\nvar fs = require('fs');\nvar path = require('path');\n\nvar koa = require('koa');\nvar body = require('koa-body');\nvar gzip = require('koa-gzip');\nvar logger = require('koa-logger');\nvar router = require('koa-router');\n\nvar api = require('./api/api');\nvar config = require('./config');\nvar servePackage = require('./servePackage');\n\nvar PORT = config.server.port || 3000;\n\nvar app = koa();\napp.name = 'exp-host';\napp.proxy = true;\napp.experimental = true;\n\napp.use(logger());\napp.use(gzip());\n\n// URL scheme\n// /-/something is for user facing URLs, ex. support, privacy\n// /--/something is for behind the scenes URLs, like API endpoints, etc.\n// /@username is a user's space\n//\n// This is desgined to preserve flexibility for anything else we want to do with the space of URLs\n\nvar siteRouter = router();\n\nsiteRouter.get('/--/git-hash', function*(next) {\n  this.type = 'text/plain';\n  this.body = yield child_process.promise.exec('git rev-parse HEAD');\n});\n\n\nsiteRouter.get('/', function*(next) {\n  var manifestUrl = 'https://www.dropbox.com/s/wjr7trh1zg12s6b/manifest.plist?dl=1';\n  this.type = 'text/html';\n  this.body = `\n  <html>\n    <head>\n      <meta name=\"viewport\" content=\"width=500\">\n      <title>E X P O N E N T ^</title>\n      <style>\n      BODY {\n        color: white;\n        background: #023c69;\n        font-family: \"HelveticaNeue-Light\", Helvetica, Sans-serif;\n        text-align: center;\n        padding-left: 15px;\n        padding-right: 15px;\n      }\n      H1 {\n        letter-spacing: 0.5em;\n        font-weight: lighter;\n      }\n      a img { border: none; }\n      .download {\n        font-weight: bold;\n        background: white;\n        color: #333333;\n        font-size: 18;\n        padding-left: 24px;\n        padding-right: 24px;\n        border: 2px solid;\n        border-color: #89a3bd;\n        border-radius: 12px;\n        margin-top: 8px;\n        padding-top: 4px;\n        padding-bottom: 4px;\n      }\n      H3 {\n        font-weight: normal;\n      }\n      H4 {\n      }\n      a { text-decoration: none; }\n      </style>\n    </head>\n    <body>\n      <h1>EXPONENT</h1>\n      <h3>Exponent is an app for React Native developers.</h3>\n      <img src=\"http://cdc03.com/ExponentIcon@3x.png\" />\n      <p><center><div style=\"width: 400px; margin-bottom: 20px;\">With Exponent, you can write React Native experiences with any computer and a text editor and a phone.\n      No need for Xcode or a simulator. Download the app now to get started.</div><br /></center></p>\n\n      <h3><a href=\"itms-services://?action=download-manifest&amp;url=${encodeURIComponent(manifestUrl)}\"><span class=\"download\" style=\"margin-top: 10px;\">Download</span></a></h3>\n\n      <div id=\"react\"></div>\n      <script src=\"http://localhost:7272/bundle.js\"></script>\n    </body>\n  </html>\n  `;\n});\n\n// generalize these and put them under an assets/ dir for the CDN\nsiteRouter.get('/bundle.js', function*(next) {\n  var cssPath = path.join(__dirname, 'web/bundle.js');\n  this.body = yield fs.promise.readFile(cssPath, 'utf8');\n});\n\nsiteRouter.get('/-/support', function*(next) {\n  this.body = \"Contact Exponent at exponent.team@gmail.com\";\n});\n\nsiteRouter.get('/-/privacy', function*(next) {\n  this.body = \"We will not sell or give away your email.\";\n});\n\nsiteRouter.all('/--/api/:method/:jsonArgs', api.callMethod);\n\nsiteRouter.get('/app/exponent', require('./browser'));\n\nsiteRouter.get('/exponent', function*(next) {\n  require('instapromise');\n  let source = yield fs.promise.readFile(path.join(__dirname, '../home.bundle.js'), 'utf8');\n  this.type = 'application/javascript';\n  this.body = source;\n});\n\nsiteRouter.get('/@:username/:pkg', servePackage);\nsiteRouter.get('/@:username', servePackage);\nsiteRouter.get('/@:username/', servePackage);\n\nsiteRouter.get('/--/to-exp/:url', function*(next) {\n  this.status = 301;\n  this.response.redirect(this.params.url);\n  //this.body = \"<script>window.location=\" + JSON.stringify(this.params.url) + \";</script>\";\n\n  // TODO: Since Safari will pop up an alert asking the user to confirm the redirect,\n  // we may want to show some web content that hints at what will happen (or maybe not?)\n});\n\nsiteRouter.get('/--/appetize', function*(next) {\n  this.type = 'text/html';\n  this.body = yield fs.promise.readFile(path.join(__dirname, '..', 'appetize.html'), 'utf8');\n});\n\nsiteRouter.get('/--/feedback', require('./feedbackSubmit'));\n\nsiteRouter.post('/--/feedback/submit', require('./feedbackSubmit'));\n\napp.use(body({formidable:{uploadDir: __dirname}}));\napp.use(siteRouter.routes());\napp.use(siteRouter.allowedMethods());\n\n// Short URLs\nsiteRouter.get('/:dotcode', function*(next) {\n  console.log(\"Handling short URL:\", this.params.dotcode);\n  var shortUrl = require('./shortUrl');\n  var dotCode = this.params.dotcode;\n  if (dotCode[0] === '.') {\n    var code = dotCode.slice(1);\n    var url = yield shortUrl.urlForCodeAsync(code);\n    console.log(\"Short URL for code\", code, \"points to URL\", url);\n    if (url) {\n      this.response.redirect(url);\n    } else {\n      this.throw(404, \"No such short URL: \" + code);\n    }\n    this.type = 'text/html',\n    this.body = \"Short URL for code \" + code;\n  } else {\n    yield next;\n  }\n});\n\n\nif (require.main === module) {\n  var port = PORT;\n  var server = app.listen(port, function () {\n    var addr = server.address();\n    var port = addr.port;\n    var host = addr.address;\n    console.log(\"Listening on http://\" + host + \":\" + port + \" using NODE_ENV=\" + process.env.NODE_ENV);\n  });\n}\n"],"sourceRoot":"/source/"}